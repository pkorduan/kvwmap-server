#!/bin/bash
#echo "Load variables in dcm geoserver"
CARGOS+=("geoserver")
geoserver_enabled=true
IMAGE_geoserver="kartoza/geoserver:latest"
CONTAINER_NAME_geoserver="geoserver"

usage_geoserver() {
  echo "install geoserver Installiert ein geoserver Image."
  echo "run geoserver      Erzeugt und startet nur den Container geoserver."
  echo "start geoserver    Startet nur den Container geoserver."
  echo "status geoserver   Zeigt den aktuellen Status des Container geoserver an."
  echo "stop geoserver     Startet nur den Container geoserver."
  echo "uninsall geoserver Deinstalliert das geoserver image und die dazugehörigen lokalen Ressourcen auf dem Hostrechner."
}

install_geoserver() {
  echo "Installiere geoserver image ..."
  docker pull $IMAGE_geoserver
}

remove_geoserver_container() {
  echo "Lösche geoserver Container ..."
  docker rm geoserver
}

run_geoserver_container() {
  echo "Erzeuge und starte den geoserver Container ..."
  docker run --name geoserver \
    -h ${SERVER_NAME}_geoserver-container \
    -p 8080:80 \
    -p 8443:443 \
    --volumes-from wwwdata \
    --link pgsql-server:pgsql \
    --restart=always \
    -d $IMAGE_geoserver
}

show_status() {
  echo "Status of container $COINTAINER_NAME"
}

start_geoserver_container() {
  echo "Starte geoserver Container. Bitte warten ..."
  docker start geoserver
}

stop_geoserver_container() {
  echo "Stoppe geoserver Container. Bitte warten ..."
  docker stop geoserver
}

uninstall_geoserver() {
  echo "Deinstalliere das geoserver image ..."
  echo "Funktion ist noch nicht implementiert!!!"
}

cases_geoserver() {
  case_found=true
  case "$1" in
    test)
      echo "test case in dcm geoserver"
    ;;

    install)
      case $2 in
        geoserver)
          install_geoserver
        ;;
      esac
    ;;

    uninstall)
      debug "Case uninstall in geoserver"
      case $2 in
        geoserver)
          #echo "Case geoserver"
          uninstall_geoserver
        ;;
        *)
          debug "No subcase $2 in geoserver"
          case_found=false
        ;;
      esac
    ;;

    remove)
      debug "Case remove in geoserver"
      case $2 in
        geoserver)
          remove_geoserver_container
        ;;
        * )
          debug "No subcase $2 in geoserver"
          case_found=false
        ;;
      esac
      docker ps -a
    ;;

    run)
      debug "Case run in geoserver"
      case $2 in
        geoserver)
          #echo "Case geoserver"
          run_geoserver_container
        ;;
        *)
          debug "No subcase $2 in geoserver"
          case_found=false
        ;;
      esac
    ;;

    start)
      debug "Case start in geoserver"
      case $2 in
        geoserver)
          start_geoserver_container
        ;;
        *)
          debug "No subcase $2 in geoserver"
          case_found=false
        ;;
      esac
    ;;

    status)
      case $2 in
        geoserver)
          show_container_status "geoserver"
        ;;
        *)
          debug "No subcase $2 in geoserver"
          case_found=false
        ;;
      esac
    ;;

    stop)
      debug "Case stop in geoserver"
      case $2 in
        geoserver)
          stop_geoserver_container
        ;;
        *)
          debug "No subcase $2 in geoserver"
          case_found=false
        ;;
      esac
    ;;

    *)
      #echo "No case found in dcm geoserver"
      case_found=false
    ;;
  esac
  debug "Case found after cases geoserver: $case_found"
}